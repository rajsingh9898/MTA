// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String       @id @default(cuid())
  name          String?
  email         String       @unique
  phoneNumber   String?      @map("phone_number")
  city          String?
  passwordHash  String       @map("password_hash")
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")
  
  itineraries   Itinerary[]
  
  @@map("users")
}

model Itinerary {
  id              String   @id @default(cuid())
  userId          String   @map("user_id")
  
  // Trip Details
  destination     String
  startDate       DateTime? @map("start_date")
  endDate         DateTime? @map("end_date")
  numDays         Int      @map("num_days")
  
  // Preferences
  budget          String   // "budget-friendly", "moderate", "luxury", "no-limit"
  ageGroups       String[] @map("age_groups") // ["children", "adults", "seniors"]
  partySize       Int      @map("party_size")
  activityLevel   String   @map("activity_level") // "relaxed", "moderate", "active", "very-active"
  
  // New preference fields
  dietaryRestrictions String[] @default([]) @map("dietary_restrictions")
  accessibilityNeeds  String[] @default([]) @map("accessibility_needs")
  interests           String[] @default([]) @map("interests")
  
  // Sharing
  shareToken      String?  @unique @map("share_token")
  isPublic        Boolean  @default(false) @map("is_public")
  
  // Generated Itinerary (JSONB)
  itineraryData   Json     @map("itinerary_data")
  
  // Metadata
  name            String?
  regenerationCount Int    @default(0) @map("regeneration_count")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")
  
  // Relations
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([destination])
  @@index([createdAt])
  @@index([shareToken])
  @@map("itineraries")
}

